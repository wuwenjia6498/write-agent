# 终极重构任务：样文矩阵、精准风格驱动与自定义标签系统

## 1. 数据库 Schema 与后端分析升级
- **`style_samples` 字段扩展**：在 `style_samples` 表中新增 `custom_tags` (JSONB 数组) 字段，用于存放主编定义的风格标签。
- **6 维特征分析升级**：当样文上传或点击“重新分析”时，后端需执行深度的特征提取。分析结果必须涵盖：**开头习惯、句式特征、段落节奏、语气特点、结尾风格、常用表达**。
- **独立指纹持久化**：确保每篇样文的 6 维分析结果独立存入其 `style_profile` 字段。**严禁**再进行多篇样文的文本拼接或综合 DNA 合成。

## 2. 样文管理页优化 (样文矩阵与标签管理)
- **核心信息外露 (参考 image_725714.png)**：
    - 在样文列表的卡片上，直接展示该样文的 **6 维特征摘要**（图标+核心词），使用户无需点开详情即可对比不同样文的写作范式。
- **自定义标签系统**：
    - **交互实现**：在每篇样文卡片实现即时标签编辑。支持主编通过 Input 框手动增删标签。
    - **初始集预设**：默认加载行业专属标签：`#绘本解析`、`#整本书阅读`、`#深度精读`、`#主题书单`、`#理性专业`。
    - **视觉区分**：主编定义的标签（建议使用蓝色）与 AI 建议的标签（建议使用灰色）需有明显的视觉区别。
- **逻辑清理**：移除“立即分析样文（合成 DNA）”按钮，系统正式切换为基于单篇样文的 **“样文矩阵”模式**。

## 3. 创作工作台 Step 5：样文自动推荐 (Smart Match)
- **样文匹配算法**：
    - **匹配逻辑**：对比 Step 1 生成的 Brief 意图与当前频道内所有样文的 `custom_tags` 关键词及其 6 维结构特征。
    - **权重分配**：主编手动定义的 `custom_tags` 具有最高匹配权重。
- **工作台 UI 呈现**：
    - **全流程去 JSON 化**：彻底移除页面上方原始的 JSON 代码显示窗，提升界面文学美感。
    - **智能推荐卡片**：在显著位置高亮展示 1 篇匹配度最高的参考样文，并给出推荐理由（例如：“此样文标签 [#绘本解析] 与本次选题高度契合”）。
    - **手动决策**：主编可一键确认推荐样文，或从当前频道库中手动点选其他样文作为本篇写作的唯一标杆。

## 4. Step 7：初稿生成与执行约束
- **单一标杆驱动**：在生成初稿时，Prompt 必须强制 AI 严格复刻且**仅复刻**所选定样文的结构逻辑与 6 维特征指令（开头方式、句式比例、段落节奏等）。
- **指令覆盖逻辑**：若主编在 Step 5 的确认环节微调了“创作指南”或“结构逻辑”，这些人工干预必须覆盖样文的默认特征，并作为 Step 7 的最高优先级指令。

## 5. 执行前置要求 (Think Aloud)
**请在编写代码前针对以下逻辑给出方案：**
1. **语义匹配实现**：你打算如何实现选题意图与 `custom_tags` 的关联？是基于关键词检索还是 Embedding 向量相似度？
2. **UI 适配性**：在样文卡片上增加 6 维特征摘要后，如何确保在不同屏幕尺寸下保持排版的整洁与可读性？
3. **指令优先级管理**：在 Step 7 中，如何确保 AI 既遵循频道的“基本人格设定”，又能精准执行特定样文的“写作结构约束”？