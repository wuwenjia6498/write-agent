# 🤖 AI功能使用指南

## ✅ AI功能已集成完成

恭喜！老约翰自动化写作AGENT的AI功能已经完整集成。

---

## 🔑 配置API Key

### 步骤1：获取Anthropic API Key

1. 访问：https://console.anthropic.com/
2. 注册/登录账号
3. 进入"API Keys"页面
4. 点击"Create Key"创建新的API Key
5. 复制生成的Key（格式：`sk-ant-xxxxx`）

### 步骤2：配置环境变量

在 `server` 目录下创建 `.env` 文件：

```bash
cd server
copy .env.example .env  # Windows
# 或
cp .env.example .env    # Linux/Mac
```

编辑 `.env` 文件，填入你的API Key：

```env
ANTHROPIC_API_KEY=sk-ant-your-actual-key-here
```

### 步骤3：重启后端服务

停止当前运行的后端服务（Ctrl+C），然后重新启动：

```bash
cd server
.\venv\Scripts\python.exe main.py
```

---

## 🎯 完整AI工作流说明

### 9步SOP自动化流程

启动工作流后，AI将自动执行：

#### **Step 1: 理解需求 & 保存Brief** ⚡ 自动执行
- AI分析用户输入的创作需求
- 提取：主题、目标读者、期望字数、关键词
- Think Aloud: 展示需求分析过程

#### **Step 2: 信息搜索与知识管理** ⚡ 自动执行
- 列出需要调研的信息点
- 标注信息来源的重要性
- Think Aloud: 展示调研规划思路

#### **Step 3: 选题讨论（必做）** 🛑 卡点等待
- AI生成3-4个选题方向
- 每个选题包含：标题、核心观点、大纲、工作量评估、优劣分析
- **用户需要选择一个选题后点击"继续"**
- Think Aloud: 展示选题生成的思考过程

#### **Step 4: 创建协作文档** ⚡ 自动执行
- 生成AI任务清单
- 列出用户需提供的内容（真实案例、个人观点、数据支持）
- Think Aloud: 展示任务分工规划

#### **Step 5: 风格与素材检索** ⚡ 自动执行
- 根据频道配置分析风格要求
- 列出需要检索的素材标签和关键词
- 融入品牌特色元素（如"揉馒头"隐喻）
- Think Aloud: 展示风格分析和素材规划

#### **Step 6: 挂起等待** 🛑 卡点等待
- 显示数据确认清单
- **用户确认所有必需素材已准备好后点击"继续"**
- 绝不编造虚假信息
- Think Aloud: 提醒用户确认数据

#### **Step 7: 初稿创作** ⚡ 自动执行
- AI根据选题、风格、素材创作初稿
- 严格遵守频道规则和屏蔽词
- 融入个人视角和真实案例
- Think Aloud: 展示创作过程和决策

#### **Step 8: 三遍审校机制** ⚡ 自动执行
- **一审内容**：事实准确性、逻辑清晰度
- **二审风格**：去AI味、检查屏蔽词、口语化
- **三审细节**：句子长度、段落节奏、标点符号
- 输出审校报告和修改后版本
- Think Aloud: 展示审校发现的问题

#### **Step 9: 文章配图** ⚡ 自动执行
- 提供5-8张配图建议
- 生成AI绘图提示词
- 输出带配图的Markdown代码
- Think Aloud: 展示配图方案思路

---

## 🎨 核心特色

### 1. 频道人格切换
不同频道AI会自动切换不同的"人格"：

- **深度阅读**：专业、有文学厚度、逻辑严密
- **绘本阅读**：温润、活泼、强调画面感
- **育儿方向**：睿智老友式对谈、平等、有温度

### 2. 全局屏蔽词过滤
AI自动避免以下8大类屏蔽词：
1. 开场陈词滥调（"在当今...时代"）
2. 逻辑结构词过度使用（"综上所述"）
3. 模糊表达（"在一定程度上"）
4. 冗余表达（"进行...活动"）
5. 过度客观（"据报道"）
6. 标题党用语（"震惊"、"必看"）
7. 教育领域陈词（"寓教于乐"）
8. 过度热情（"亲"、"么么哒"）

### 3. Think Aloud透明化
每一步都会展示AI的思考过程：
- 📋 需求分析
- 🔍 调研规划
- 💡 选题思路
- 📝 分工规划
- 🎨 风格把握
- ⏸️ 数据确认
- ✍️ 创作决策
- 🔍 审校发现
- 🖼️ 配图方案

### 4. 强制卡点机制
两个必做卡点确保质量：
- **Step 3 选题讨论**：避免方向错误
- **Step 6 数据确认**：确保不编造信息

---

## 🚀 快速体验

1. **访问工作台**：http://localhost:3000/workbench

2. **选择频道**：建议先试"深度阅读"

3. **输入需求**：
```
我想写一篇关于《窗边的小豆豆》整本书阅读策略的文章，
目标读者是小学生家长，期望3000字左右，
重点讲如何引导孩子深度理解这本书的教育价值。
```

4. **点击"启动创作流程"**

5. **观察三栏界面**：
   - 左侧：9步进度实时更新
   - 中间：AI生成的内容
   - 右侧：Think Aloud思考过程

6. **在卡点处交互**：
   - Step 3: 选择一个你喜欢的选题
   - Step 6: 确认数据准备就绪

7. **等待完成**：整个流程约需3-5分钟

---

## 💡 使用技巧

### 1. 需求描述越详细越好
包含以下信息：
- 具体主题/书名
- 目标读者群体
- 期望字数
- 特殊要求或侧重点

### 2. 充分利用选题讨论
- 仔细阅读3-4个选题方案
- 选择最符合你需求的方向
- 可以在选题基础上微调

### 3. 准备真实素材
在Step 6之前准备好：
- 个人真实经历
- 具体案例
- 数据支持
- 独特观点

### 4. 审校结果二次优化
AI审校后的文章可以：
- 手动微调个别表达
- 补充更多个人色彩
- 调整段落顺序

---

## ⚠️ 注意事项

### API使用成本
- Claude 3.5 Sonnet价格：$3/M input tokens，$15/M output tokens
- 单次完整工作流预计消耗：
  - 输入约10K tokens
  - 输出约8K tokens
  - 总成本约$0.15-0.30/篇文章

### 速率限制
- Anthropic默认限制：每分钟50次请求
- 建议不要同时启动多个工作流

### 内容准确性
- AI可能产生"幻觉"，请核查事实
- 重要数据务必二次验证
- 引用内容需标注来源

---

## 🔧 故障排除

### Q: 提示"AI服务未配置ANTHROPIC_API_KEY"
**A:** 
1. 检查 `server/.env` 文件是否存在
2. 确认API Key格式正确（sk-ant-开头）
3. 重启后端服务

### Q: API请求超时
**A:**
1. 检查网络连接
2. 确认API Key有效且有余额
3. 尝试减少max_tokens参数

### Q: 生成内容不符合预期
**A:**
1. 检查频道配置是否正确
2. 调整需求描述的详细程度
3. 在选题阶段选择更合适的方向

---

## 📚 更多资源

- **API文档**：http://localhost:8000/docs
- **Anthropic文档**：https://docs.anthropic.com/
- **项目文档**：查看 `PROJECT_SUMMARY.md`

---

**🎊 现在开始体验完整的AI创作流程吧！**

